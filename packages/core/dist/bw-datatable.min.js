var BWDataTable=(()=>{var Vt=Object.defineProperty;var we=Object.getOwnPropertyDescriptor;var Se=Object.getOwnPropertyNames;var ye=Object.prototype.hasOwnProperty;var _e=(y,t)=>{for(var s in t)Vt(y,s,{get:t[s],enumerable:!0})},Ce=(y,t,s,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Se(t))!ye.call(y,n)&&n!==s&&Vt(y,n,{get:()=>t[n],enumerable:!(i=we(t,n))||i.enumerable});return y};var ve=y=>Ce(Vt({},"__esModule",{value:!0}),y);var At=(y,t,s)=>{if(!t.has(y))throw TypeError("Cannot "+s)};var e=(y,t,s)=>(At(y,t,"read from private field"),s?s.call(y):t.get(y)),u=(y,t,s)=>{if(t.has(y))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(y):t.set(y,s)},x=(y,t,s,i)=>(At(y,t,"write to private field"),i?i.call(y,s):t.set(y,s),s);var l=(y,t,s)=>(At(y,t,"access private method"),s);var ke={};_e(ke,{BWDataTable:()=>et,EventBus:()=>Z,PluginSystem:()=>Y,StateManager:()=>Q,default:()=>et});var T,I,Z=class{constructor(){u(this,T,new Map);u(this,I,new Map)}on(t,s){return e(this,T).has(t)||e(this,T).set(t,new Set),e(this,T).get(t).add(s),()=>this.off(t,s)}off(t,s){e(this,T).has(t)&&e(this,T).get(t).delete(s)}emit(t,s){if(e(this,I).has(t))for(let i of e(this,I).get(t)){let n=i(s);if(n===!1)return!1;n!==void 0&&(s=n)}if(e(this,T).has(t))for(let i of e(this,T).get(t))i(s);return s}intercept(t,s){return e(this,I).has(t)||e(this,I).set(t,new Set),e(this,I).get(t).add(s),()=>e(this,I).get(t).delete(s)}clear(){e(this,T).clear(),e(this,I).clear()}};T=new WeakMap,I=new WeakMap;var jt=Z;function Ut(){return{data:[],rows:[],columns:[],columnOrder:[],columnWidths:{},pinnedLeft:[],pinnedRight:[],hiddenColumns:[],sort:[],filters:{},globalFilter:"",selected:new Set,selectionMode:"multi",page:0,pageSize:20,totalRows:0,editingCell:null,editingRow:null,isLoading:!1,error:null}}var C,A,F,ot,dt,Xt,Q=class{constructor(t,s={}){u(this,dt);u(this,C,void 0);u(this,A,void 0);u(this,F,[]);u(this,ot,50);x(this,A,t),x(this,C,{...Ut(),...s})}getState(){return{...e(this,C)}}get(t){return e(this,C)[t]}setState(t,s={}){let{silent:i=!1,track:n=!0}=s;n&&l(this,dt,Xt).call(this);let a=e(this,C);x(this,C,{...e(this,C),...t}),i||e(this,A).emit("state:change",{prev:a,current:e(this,C),changes:Object.keys(t)})}reset(t={}){x(this,C,{...Ut(),...t}),x(this,F,[]),e(this,A).emit("state:reset",e(this,C))}getHistory(){return e(this,F)}restore(t){x(this,C,{...t,selected:new Set(t.selected)}),e(this,A).emit("state:restore",e(this,C))}batch(t){let s=e(this,C);t(),e(this,A).emit("state:change",{prev:s,current:e(this,C),changes:["batch"]})}};C=new WeakMap,A=new WeakMap,F=new WeakMap,ot=new WeakMap,dt=new WeakSet,Xt=function(){let t=JSON.parse(JSON.stringify({...e(this,C),selected:[...e(this,C).selected]}));e(this,F).push(t),e(this,F).length>e(this,ot)&&e(this,F).shift()};var Gt=Q;var k,tt,N,Y=class{constructor(t){u(this,k,new Map);u(this,tt,null);u(this,N,void 0);x(this,N,t)}setAPI(t){x(this,tt,t)}register(t,s={}){let{name:i,init:n,dependencies:a=[]}=t;if(!i)throw new Error("Plugin must have a name");if(e(this,k).has(i))return console.warn(`Plugin "${i}" already registered, skipping`),e(this,k).get(i).instance;if(typeof n!="function")throw new Error(`Plugin "${i}" must have init function`);for(let h of a)if(!e(this,k).has(h))throw new Error(`Plugin "${i}" requires "${h}" plugin`);let d=n({...e(this,tt),options:s});return e(this,k).set(i,{plugin:t,instance:d,options:s}),e(this,N).emit("plugin:registered",{name:i,instance:d}),d}unregister(t){if(!e(this,k).has(t)){console.warn(`Plugin "${t}" not found`);return}let{plugin:s,instance:i}=e(this,k).get(t);typeof s.destroy=="function"&&s.destroy(i),e(this,k).delete(t),e(this,N).emit("plugin:unregistered",{name:t})}get(t){return e(this,k).get(t)?.instance||null}has(t){return e(this,k).has(t)}list(){return[...e(this,k).keys()]}destroyAll(){for(let[t,{plugin:s,instance:i}]of e(this,k))typeof s.destroy=="function"&&s.destroy(i);e(this,k).clear(),e(this,N).emit("plugin:destroyedAll")}};k=new WeakMap,tt=new WeakMap,N=new WeakMap;var Jt=Y;var xe={data:[],dataPath:null,totalPath:null,rowId:"id",columns:null,sortable:!0,filterable:!0,selectable:!0,editable:!1,paginated:!0,page:0,pageSize:20,pageSizes:[10,20,50,100],selectionMode:"multi",theme:"light",striped:!0,bordered:!0,hoverable:!0,containerClass:"",tableClass:"",editOnClick:!1,editableColumns:null,resizable:!0,minColumnWidth:50,maxColumnWidth:null,keyboardNavigation:!0,loading:!1,loadingText:"Loading...",emptyText:"No data available",errorText:null,onReady:null,onSort:null,onFilter:null,onSelect:null,onEdit:null,onPageChange:null,onError:null,onEditStart:null,onEditEnd:null,onEditCancel:null},p,r,g,o,H,m,mt,pt,Zt,st,Ft,K,ht,it,Ht,wt,Qt,St,Yt,yt,te,_t,ee,Ct,se,j,ct,vt,ie,z,R,Kt,Ee,xt,ae,Et,ne,kt,le,Lt,re,$t,oe,at,qt,Mt,de,nt,Nt,U,ut,X,ft,q,B,G,bt,zt,he,Wt,ce,lt,Ot,rt,Bt,Tt,ue,E,L,$,M,J,gt,Pt,fe,Dt,be,It,ge,Rt,me,et=class{constructor(t,s={}){u(this,pt);u(this,st);u(this,K);u(this,it);u(this,wt);u(this,St);u(this,yt);u(this,_t);u(this,Ct);u(this,j);u(this,vt);u(this,z);u(this,Kt);u(this,xt);u(this,Et);u(this,kt);u(this,Lt);u(this,$t);u(this,at);u(this,Mt);u(this,nt);u(this,U);u(this,X);u(this,q);u(this,G);u(this,zt);u(this,Wt);u(this,lt);u(this,rt);u(this,Tt);u(this,E);u(this,$);u(this,J);u(this,Pt);u(this,Dt);u(this,It);u(this,Rt);u(this,p,void 0);u(this,r,void 0);u(this,g,void 0);u(this,o,void 0);u(this,H,void 0);u(this,m,{toolbar:null,header:null,body:null,footer:null,overlay:null});u(this,mt,!1);if(x(this,p,typeof t=="string"?document.querySelector(t):t),!e(this,p))throw new Error(`BWDataTable: Container "${t}" not found`);x(this,r,{...xe,...s}),x(this,g,new jt),x(this,o,new Gt(e(this,g))),x(this,H,new Jt(e(this,g))),e(this,H).setAPI(l(this,Tt,ue).call(this)),l(this,pt,Zt).call(this)}hideColumn(t){let s=[...e(this,o).get("hiddenColumns")||[]];s.includes(t)||(s.push(t),e(this,o).setState({hiddenColumns:s},{silent:!0}),this.render(),e(this,g).emit("column:hide",{columnId:t}))}showColumn(t){let s=[...e(this,o).get("hiddenColumns")||[]],i=s.indexOf(t);i>-1&&(s.splice(i,1),e(this,o).setState({hiddenColumns:s},{silent:!0}),this.render(),e(this,g).emit("column:show",{columnId:t}))}toggleColumn(t){(e(this,o).get("hiddenColumns")||[]).includes(t)?this.showColumn(t):this.hideColumn(t)}getHiddenColumns(){return[...e(this,o).get("hiddenColumns")||[]]}getVisibleColumns(){let t=e(this,o).get("hiddenColumns")||[];return e(this,o).get("columns").filter(s=>!t.includes(s.id))}setLoading(t,s=null){s&&(e(this,r).loadingText=s),e(this,o).setState({isLoading:t},{silent:!0}),l(this,J,gt).call(this,e(this,o).getState())}setError(t){e(this,o).setState({error:t},{silent:!0}),l(this,J,gt).call(this,e(this,o).getState())}setEmptyText(t){e(this,r).emptyText=t,this.render()}focusCell(t,s){l(this,j,ct).call(this,t,s)}getFocusedCell(){return e(this,o).get("focusedCell")}setColumnWidth(t,s){s=Math.max(s,e(this,r).minColumnWidth),e(this,r).maxColumnWidth&&(s=Math.min(s,e(this,r).maxColumnWidth));let i={...e(this,o).get("columnWidths")};i[t]=s,e(this,o).setState({columnWidths:i},{silent:!0}),this.render()}getColumnWidths(){return{...e(this,o).get("columnWidths")}}resetColumnWidths(){e(this,o).setState({columnWidths:{}},{silent:!0}),this.render()}startEdit(t,s){if(!e(this,r).editable)return;let i=e(this,o).get("columns").find(a=>a.id===s);if(!i||!l(this,U,ut).call(this,i))return;let n=e(this,p).querySelector(`[data-row-id="${t}"] [data-cell="${s}"]`);if(n){let a=e(this,o).get("rows").find(h=>l(this,E,L).call(this,h)===t),d=l(this,$,M).call(this,a,i);e(this,o).setState({editingCell:{rowId:t,columnId:s,originalValue:d}},{silent:!0}),l(this,X,ft).call(this,n,i,d)}}stopEdit(){l(this,q,B).call(this)}cancelEdit(){l(this,G,bt).call(this)}isEditing(){return e(this,o).get("editingCell")}setCellValue(t,s,i){l(this,lt,Ot).call(this,t,s,i),this.render()}use(t,s={}){return e(this,H).register(t,s),this}getPlugin(t){return e(this,H).get(t)}render(){let t=e(this,o).getState();e(this,g).emit("render:before",{state:t})!==!1&&(l(this,Pt,fe).call(this,t),l(this,Dt,be).call(this,t),l(this,Rt,me).call(this,t),l(this,J,gt).call(this,t),e(this,g).emit("render:after",{state:t,slots:e(this,m)}))}sort(t,s=null){let i=e(this,o).getState(),n=i.sort.find(f=>f.column===t);if(s===null&&(n?n.dir==="asc"?s="desc":s=null:s="asc"),e(this,g).emit("sort:before",{columnId:t,dir:s})===!1)return;let d=s?[{column:t,dir:s}]:[],h=[...i.data];if(d.length){let f=i.columns.find(b=>b.id===t);h.sort((b,w)=>{let _=l(this,$,M).call(this,b,f),c=l(this,$,M).call(this,w,f);if(_==null&&c==null)return 0;if(_==null)return 1;if(c==null)return-1;let S=0;return _<c?S=-1:_>c&&(S=1),s==="desc"?-S:S})}e(this,o).setState({sort:d,rows:h,page:0},{silent:!0}),this.render(),e(this,g).emit("sort:after",{columnId:t,dir:s,rows:h}),e(this,r).onSort&&e(this,r).onSort({column:t,dir:s},this)}filter(t,s){let i=e(this,o).getState();if(e(this,g).emit("filter:before",{columnId:t,value:s})===!1)return;let a={...i.filters},d=i.globalFilter;t==="global"?d=s:s===""||s===null||s===void 0?delete a[t]:a[t]=s;let h=[...i.data];if(d){let f=String(d).toLowerCase();h=h.filter(b=>i.columns.some(w=>{let _=l(this,$,M).call(this,b,w);return String(_).toLowerCase().includes(f)}))}for(let[f,b]of Object.entries(a)){let w=i.columns.find(c=>c.id===f);if(!w)continue;let _=String(b).toLowerCase();h=h.filter(c=>{let S=l(this,$,M).call(this,c,w);return String(S).toLowerCase().includes(_)})}if(i.sort.length){let f=i.sort[0],b=i.columns.find(w=>w.id===f.column);h.sort((w,_)=>{let c=l(this,$,M).call(this,w,b),S=l(this,$,M).call(this,_,b);if(c==null&&S==null)return 0;if(c==null)return 1;if(S==null)return-1;let v=0;return c<S?v=-1:c>S&&(v=1),f.dir==="desc"?-v:v})}e(this,o).setState({filters:a,globalFilter:d,rows:h,page:0,totalRows:h.length},{silent:!0}),this.render(),e(this,g).emit("filter:after",{filters:a,globalFilter:d,rows:h}),e(this,r).onFilter&&e(this,r).onFilter({filters:a,globalFilter:d},this)}goToPage(t){let s=e(this,o).getState(),i=Math.ceil(s.totalRows/s.pageSize);t=Math.max(0,Math.min(t,i-1)),t!==s.page&&(e(this,o).setState({page:t},{silent:!0}),this.render(),e(this,r).onPageChange&&e(this,r).onPageChange(t,this))}setPageSize(t){e(this,o).setState({pageSize:t,page:0},{silent:!0}),this.render()}getData(){return[...e(this,o).get("rows")]}getOriginalData(){return[...e(this,o).get("data")]}setData(t){let s=l(this,st,Ft).call(this,t),i=e(this,r).columns||l(this,it,Ht).call(this,s);e(this,o).setState({data:s,rows:[...s],columns:i,columnOrder:i.map(n=>n.id),totalRows:s.length,page:0,selected:new Set,sort:[],filters:{},globalFilter:""},{silent:!0}),this.render()}getSelected(){let t=e(this,o).getState(),s=t.selected;return t.rows.filter(i=>s.has(l(this,E,L).call(this,i)))}getSelectedIds(){return[...e(this,o).get("selected")]}select(t){e(this,o).setState({selected:new Set(t)},{silent:!0}),this.render()}clearSelection(){e(this,o).setState({selected:new Set},{silent:!0}),this.render()}refresh(){this.render()}reload(){let t=e(this,o).getState();this.filter("global",t.globalFilter)}reset(){let t=e(this,o).getState();e(this,o).setState({rows:[...t.data],sort:[],filters:{},globalFilter:"",selected:new Set,page:0,totalRows:t.data.length},{silent:!0}),this.render()}destroy(){e(this,H).destroyAll(),e(this,g).clear(),e(this,p).innerHTML="",e(this,p).classList.remove("bw-datatable","bw-datatable--light","bw-datatable--dark","bw-datatable--auto","bw-datatable--striped","bw-datatable--bordered","bw-datatable--hoverable"),e(this,g).emit("table:destroyed")}on(t,s){return e(this,g).on(t,s)}off(t,s){e(this,g).off(t,s)}};p=new WeakMap,r=new WeakMap,g=new WeakMap,o=new WeakMap,H=new WeakMap,m=new WeakMap,mt=new WeakMap,pt=new WeakSet,Zt=function(){let t=l(this,st,Ft).call(this,e(this,r).data),s=e(this,r).columns||l(this,it,Ht).call(this,t);e(this,o).setState({data:t,rows:[...t],columns:s,columnOrder:s.map(i=>i.id),page:e(this,r).page,pageSize:e(this,r).pageSize,selectionMode:e(this,r).selectionMode,totalRows:t.length,focusedCell:null,isLoading:e(this,r).loading,error:e(this,r).errorText},{silent:!0,track:!1}),l(this,yt,te).call(this),l(this,_t,ee).call(this),x(this,mt,!0),e(this,g).emit("table:ready",{table:this}),e(this,r).onReady&&e(this,r).onReady(this),this.render()},st=new WeakSet,Ft=function(t){return t?Array.isArray(t)?t:e(this,r).dataPath?l(this,K,ht).call(this,t,e(this,r).dataPath)||[]:[]:[]},K=new WeakSet,ht=function(t,s){if(!(!t||!s))return s.split(".").reduce((i,n)=>i?.[n],t)},it=new WeakSet,Ht=function(t){if(!t.length)return[];let s=t[0];return Object.keys(s).map(i=>({id:i,header:l(this,wt,Qt).call(this,i),field:i,type:l(this,St,Yt).call(this,s[i])}))},wt=new WeakSet,Qt=function(t){return t.replace(/([A-Z])/g," $1").replace(/^./,s=>s.toUpperCase()).trim()},St=new WeakSet,Yt=function(t){return t==null?"text":typeof t=="number"?"number":typeof t=="boolean"?"boolean":t instanceof Date||typeof t=="string"&&/^\d{4}-\d{2}-\d{2}/.test(t)?"date":"text"},yt=new WeakSet,te=function(){e(this,p).classList.add("bw-datatable"),e(this,r).theme&&e(this,p).classList.add(`bw-datatable--${e(this,r).theme}`),e(this,r).striped&&e(this,p).classList.add("bw-datatable--striped"),e(this,r).bordered&&e(this,p).classList.add("bw-datatable--bordered"),e(this,r).hoverable&&e(this,p).classList.add("bw-datatable--hoverable"),e(this,r).containerClass&&e(this,p).classList.add(e(this,r).containerClass),e(this,p).innerHTML=`
      <div class="bw-datatable__toolbar" data-slot="toolbar"></div>
      <div class="bw-datatable__wrapper">
        <table class="bw-datatable__table ${e(this,r).tableClass}">
          <thead class="bw-datatable__header" data-slot="header"></thead>
          <tbody class="bw-datatable__body" data-slot="body"></tbody>
        </table>
      </div>
      <div class="bw-datatable__footer" data-slot="footer"></div>
      <div class="bw-datatable__overlay" data-slot="overlay"></div>
    `,e(this,m).toolbar=e(this,p).querySelector('[data-slot="toolbar"]'),e(this,m).header=e(this,p).querySelector('[data-slot="header"]'),e(this,m).body=e(this,p).querySelector('[data-slot="body"]'),e(this,m).footer=e(this,p).querySelector('[data-slot="footer"]'),e(this,m).overlay=e(this,p).querySelector('[data-slot="overlay"]')},_t=new WeakSet,ee=function(){e(this,g).on("state:change",({changes:t})=>{(t.includes("rows")||t.includes("columns")||t.includes("batch"))&&this.render()}),e(this,m).body.addEventListener("click",t=>l(this,kt,le).call(this,t)),e(this,m).header.addEventListener("click",t=>l(this,Lt,re).call(this,t)),e(this,m).footer.addEventListener("click",t=>l(this,$t,oe).call(this,t)),e(this,m).body.addEventListener("dblclick",t=>l(this,nt,Nt).call(this,t)),e(this,r).editOnClick&&e(this,m).body.addEventListener("click",t=>{t.target.closest("[data-cell]")&&!t.target.closest("input, select")&&l(this,nt,Nt).call(this,t)}),e(this,r).resizable&&(e(this,m).header.addEventListener("mousedown",t=>l(this,xt,ae).call(this,t)),e(this,m).header.addEventListener("dblclick",t=>l(this,Et,ne).call(this,t))),e(this,r).keyboardNavigation&&(e(this,p).setAttribute("tabindex","0"),e(this,p).addEventListener("keydown",t=>l(this,vt,ie).call(this,t)),e(this,m).body.addEventListener("click",t=>l(this,Ct,se).call(this,t)))},Ct=new WeakSet,se=function(t){let s=t.target.closest("[data-cell]"),i=t.target.closest("[data-row-id]");if(!s||!i)return;let n=i.dataset.rowId,a=s.dataset.cell;l(this,j,ct).call(this,n,a)},j=new WeakSet,ct=function(t,s){let i=e(this,p).querySelector(".bw-datatable__td--focused");i&&i.classList.remove("bw-datatable__td--focused");let n=e(this,p).querySelector(`[data-row-id="${t}"] [data-cell="${s}"]`);n&&(n.classList.add("bw-datatable__td--focused"),e(this,o).setState({focusedCell:{rowId:t,columnId:s}},{silent:!0,track:!1}),e(this,p).focus())},vt=new WeakSet,ie=function(t){if(e(this,o).get("editingCell")||t.target.matches("input, select, textarea"))return;let s=e(this,o).get("focusedCell");switch(t.key){case"ArrowUp":t.preventDefault(),l(this,z,R).call(this,"up");break;case"ArrowDown":t.preventDefault(),l(this,z,R).call(this,"down");break;case"ArrowLeft":t.preventDefault(),l(this,z,R).call(this,"left");break;case"ArrowRight":t.preventDefault(),l(this,z,R).call(this,"right");break;case"Home":t.preventDefault(),t.ctrlKey?l(this,z,R).call(this,"first"):l(this,z,R).call(this,"rowStart");break;case"End":t.preventDefault(),t.ctrlKey?l(this,z,R).call(this,"last"):l(this,z,R).call(this,"rowEnd");break;case"Enter":t.preventDefault(),s&&e(this,r).editable&&this.startEdit(s.rowId,s.columnId);break;case" ":t.preventDefault(),s&&e(this,r).selectable&&l(this,at,qt).call(this,s.rowId,t);break;case"Tab":s&&(t.preventDefault(),l(this,z,R).call(this,t.shiftKey?"left":"right"));break}},z=new WeakSet,R=function(t){let s=e(this,o).getState(),i=s.focusedCell,n=s.columns.filter(c=>!s.hiddenColumns?.includes(c.id));if(!n.length)return;let a=e(this,r).paginated?s.page*s.pageSize:0,d=e(this,r).paginated?a+s.pageSize:s.rows.length,h=s.rows.slice(a,d);if(!h.length)return;let f,b;switch(i?(f=h.findIndex(c=>l(this,E,L).call(this,c)===i.rowId),b=n.findIndex(c=>c.id===i.columnId),f===-1&&(f=0,b=0)):(f=0,b=0),t){case"up":f=Math.max(0,f-1);break;case"down":f=Math.min(h.length-1,f+1);break;case"left":b--,b<0&&(b=n.length-1,f=Math.max(0,f-1));break;case"right":b++,b>=n.length&&(b=0,f=Math.min(h.length-1,f+1));break;case"first":f=0,b=0;break;case"last":f=h.length-1,b=n.length-1;break;case"rowStart":b=0;break;case"rowEnd":b=n.length-1;break}let w=h[f],_=n[b];w&&_&&l(this,j,ct).call(this,l(this,E,L).call(this,w),_.id)},Kt=new WeakSet,Ee=function(){let t=e(this,p).querySelector(".bw-datatable__td--focused");t&&t.classList.remove("bw-datatable__td--focused"),e(this,o).setState({focusedCell:null},{silent:!0,track:!1})},xt=new WeakSet,ae=function(t){let s=t.target.closest("[data-resize]");if(!s)return;t.preventDefault(),t.stopPropagation();let i=s.dataset.resize,n=s.closest("th"),a=t.pageX,d=n.offsetWidth,h=!1;e(this,p).classList.add("bw-datatable--resizing");let f=w=>{h=!0;let _=w.pageX-a,c=d+_;c=Math.max(c,e(this,r).minColumnWidth),e(this,r).maxColumnWidth&&(c=Math.min(c,e(this,r).maxColumnWidth)),n.style.width=`${c}px`,n.style.minWidth=`${c}px`,n.style.maxWidth=`${c}px`,e(this,m).body.querySelectorAll(`[data-cell="${i}"]`).forEach(v=>{v.style.width=`${c}px`,v.style.minWidth=`${c}px`,v.style.maxWidth=`${c}px`})},b=w=>{if(document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",b),e(this,p).classList.remove("bw-datatable--resizing"),h){let c=n.offsetWidth,S={...e(this,o).get("columnWidths")};S[i]=c,e(this,o).setState({columnWidths:S},{silent:!0}),e(this,g).emit("column:resize",{columnId:i,width:c})}let _=c=>{c.stopPropagation(),c.preventDefault()};n.addEventListener("click",_,{capture:!0,once:!0}),setTimeout(()=>{n.removeEventListener("click",_,{capture:!0})},100)};document.addEventListener("mousemove",f),document.addEventListener("mouseup",b)},Et=new WeakSet,ne=function(t){let s=t.target.closest("[data-resize]");if(!s)return;t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let i=s.dataset.resize;if(!e(this,o).get("columns").find(w=>w.id===i))return;let a=e(this,r).minColumnWidth,h=s.closest("th").querySelector(".bw-datatable__th-content");h&&(a=Math.max(a,h.scrollWidth+40)),e(this,m).body.querySelectorAll(`[data-cell="${i}"]`).forEach(w=>{a=Math.max(a,w.scrollWidth+32)}),e(this,r).maxColumnWidth&&(a=Math.min(a,e(this,r).maxColumnWidth));let b={...e(this,o).get("columnWidths")};b[i]=a,e(this,o).setState({columnWidths:b},{silent:!0}),this.render(),e(this,g).emit("column:resize",{columnId:i,width:a})},kt=new WeakSet,le=function(t){let s=t.target.closest("[data-cell]"),i=t.target.closest("[data-row-id]"),n=t.target.closest("[data-select-row]");if(!i)return;let a=i.dataset.rowId,d=s?.dataset.cell;s&&e(this,g).emit("cell:click",{rowId:a,columnId:d,event:t}),e(this,g).emit("row:click",{rowId:a,event:t}),e(this,r).selectable&&e(this,o).get("selectionMode")!=="none"&&(n||!s)&&l(this,at,qt).call(this,a,t)},Lt=new WeakSet,re=function(t){let s=t.target.closest("[data-select-all]");if(s){l(this,Mt,de).call(this,s.checked);return}let i=t.target.closest("[data-column]");if(!i)return;let n=i.dataset.column,a=e(this,o).get("columns").find(d=>d.id===n);!e(this,r).sortable||a?.sortable===!1||this.sort(n)},$t=new WeakSet,oe=function(t){let s=t.target.closest("[data-page]");if(!s||s.disabled)return;let i=s.dataset.page,n=e(this,o).getState(),a=Math.ceil(n.totalRows/n.pageSize);switch(i){case"first":this.goToPage(0);break;case"prev":this.goToPage(n.page-1);break;case"next":this.goToPage(n.page+1);break;case"last":this.goToPage(a-1);break}},at=new WeakSet,qt=function(t,s){let i=new Set(e(this,o).get("selected")),n=e(this,o).get("selectionMode");n==="single"?i.has(t)?i.clear():(i.clear(),i.add(t)):n==="multi"&&(i.has(t)?i.delete(t):i.add(t)),e(this,o).setState({selected:i},{silent:!0}),e(this,r).onSelect&&e(this,r).onSelect([...i],this),this.render()},Mt=new WeakSet,de=function(t){let s=e(this,o).getState(),i;if(t){let n=e(this,r).paginated?s.page*s.pageSize:0,a=e(this,r).paginated?n+s.pageSize:s.rows.length,d=s.rows.slice(n,a);i=new Set(d.map(h=>l(this,E,L).call(this,h)))}else i=new Set;e(this,o).setState({selected:i},{silent:!0}),e(this,r).onSelect&&e(this,r).onSelect([...i],this),this.render()},nt=new WeakSet,Nt=function(t){if(!e(this,r).editable)return;let s=t.target.closest("[data-cell]"),i=t.target.closest("[data-row-id]");if(!s||!i)return;let n=i.dataset.rowId,a=s.dataset.cell,d=e(this,o).get("columns").find(w=>w.id===a);if(!l(this,U,ut).call(this,d))return;let h=e(this,o).get("editingCell");if(h?.rowId===n&&h?.columnId===a)return;h&&l(this,q,B).call(this);let f=e(this,o).get("rows").find(w=>l(this,E,L).call(this,w)===n),b=l(this,$,M).call(this,f,d);e(this,o).setState({editingCell:{rowId:n,columnId:a,originalValue:b}},{silent:!0}),l(this,X,ft).call(this,s,d,b),e(this,g).emit("edit:start",{rowId:n,columnId:a,value:b}),e(this,r).onEditStart&&e(this,r).onEditStart(n,a,b,this)},U=new WeakSet,ut=function(t){return t.editable===!1?!1:t.editable===!0?!0:e(this,r).editableColumns?e(this,r).editableColumns.includes(t.id):e(this,r).editable},X=new WeakSet,ft=function(t,s,i){let n=s.editType||s.type||"text",a;switch(n){case"number":a=document.createElement("input"),a.type="number",a.value=i??"",a.className="bw-datatable__edit-input";break;case"boolean":a=document.createElement("input"),a.type="checkbox",a.checked=!!i,a.className="bw-datatable__edit-checkbox";break;case"select":a=document.createElement("select"),a.className="bw-datatable__edit-select",(s.options||[]).forEach(d=>{let h=document.createElement("option");h.value=typeof d=="object"?d.value:d,h.textContent=typeof d=="object"?d.label:d,h.selected=h.value===String(i),a.appendChild(h)});break;case"date":a=document.createElement("input"),a.type="date",a.value=i?new Date(i).toISOString().split("T")[0]:"",a.className="bw-datatable__edit-input";break;default:a=document.createElement("input"),a.type="text",a.value=i??"",a.className="bw-datatable__edit-input"}a.dataset.editInput="true",a.addEventListener("keydown",d=>{switch(d.key){case"Enter":d.preventDefault(),l(this,q,B).call(this);break;case"Escape":d.preventDefault(),l(this,G,bt).call(this);break;case"Tab":d.preventDefault(),d.stopPropagation();let h=l(this,zt,he).call(this,d.shiftKey);l(this,q,B).call(this),h&&setTimeout(()=>{let f=e(this,p).querySelector(`[data-row-id="${h.rowId}"] [data-cell="${h.columnId}"]`);f&&l(this,Wt,ce).call(this,h.rowId,h.columnId,h.value,f)},50);break}}),a.addEventListener("blur",d=>{setTimeout(()=>{e(this,o).get("editingCell")&&!e(this,p).querySelector("[data-edit-input]:focus")&&l(this,q,B).call(this)},100)}),t.innerHTML="",t.appendChild(a),t.classList.add("bw-datatable__td--editing"),a.focus(),a.select&&a.select()},q=new WeakSet,B=function(){let t=e(this,o).get("editingCell");if(!t)return;let{rowId:s,columnId:i,originalValue:n}=t,a=e(this,p).querySelector("[data-edit-input]");if(!a){e(this,o).setState({editingCell:null},{silent:!0});return}let d;a.type==="checkbox"?d=a.checked:a.type==="number"?d=a.value===""?null:Number(a.value):d=a.value;let h=e(this,o).get("columns").find(b=>b.id===i);if(h.validator&&!h.validator(d,n,s)){a.classList.add("bw-datatable__edit-input--invalid");return}if(e(this,g).emit("edit:before",{rowId:s,columnId:i,value:d,oldValue:n})===!1){l(this,G,bt).call(this);return}d!==n&&l(this,lt,Ot).call(this,s,i,d),e(this,o).setState({editingCell:null},{silent:!0}),this.render(),e(this,g).emit("edit:end",{rowId:s,columnId:i,value:d,oldValue:n}),e(this,r).onEditEnd&&e(this,r).onEditEnd(s,i,d,n,this)},G=new WeakSet,bt=function(){let t=e(this,o).get("editingCell");if(!t)return;let{rowId:s,columnId:i}=t;e(this,o).setState({editingCell:null},{silent:!0}),this.render(),e(this,g).emit("edit:cancel",{rowId:s,columnId:i}),e(this,r).onEditCancel&&e(this,r).onEditCancel(s,i,this)},zt=new WeakSet,he=function(t=!1){let s=e(this,o).getState(),i=s.editingCell;if(!i)return null;let{rowId:n,columnId:a}=i,d=s.columns.filter(D=>!s.hiddenColumns?.includes(D.id)&&l(this,U,ut).call(this,D));if(!d.length)return null;let h=d.findIndex(D=>D.id===a),f=e(this,r).paginated?s.page*s.pageSize:0,b=e(this,r).paginated?f+s.pageSize:s.rows.length,w=s.rows.slice(f,b),_=w.findIndex(D=>l(this,E,L).call(this,D)===n),c=h,S=_;if(t?(c--,c<0&&(c=d.length-1,S--)):(c++,c>=d.length&&(c=0,S++)),S<0||S>=w.length)return null;let v=w[S],P=d[c],W=l(this,E,L).call(this,v),V=e(this,p).querySelector(`[data-row-id="${W}"] [data-cell="${P.id}"]`);return V?{rowId:W,columnId:P.id,column:P,value:l(this,$,M).call(this,v,P),cell:V}:null},Wt=new WeakSet,ce=function(t,s,i,n){let a=e(this,o).get("columns").find(d=>d.id===s);!n||!a||(e(this,o).setState({editingCell:{rowId:t,columnId:s,originalValue:i}},{silent:!0}),l(this,X,ft).call(this,n,a,i),e(this,g).emit("edit:start",{rowId:t,columnId:s,value:i}),e(this,r).onEditStart&&e(this,r).onEditStart(t,s,i,this))},lt=new WeakSet,Ot=function(t,s,i){let n=e(this,o).getState(),a=n.columns.find(b=>b.id===s),d=n.data.find(b=>l(this,E,L).call(this,b)===t),h=n.rows.find(b=>l(this,E,L).call(this,b)===t);if(!d||!a)return;let f=a.field||a.id;f.includes(".")?(l(this,rt,Bt).call(this,d,f,i),h!==d&&l(this,rt,Bt).call(this,h,f,i)):(d[f]=i,h!==d&&(h[f]=i))},rt=new WeakSet,Bt=function(t,s,i){let n=s.split("."),a=n.pop(),d=n.reduce((h,f)=>h[f]=h[f]||{},t);d[a]=i},Tt=new WeakSet,ue=function(){return{stateManager:e(this,o),getState:()=>e(this,o).getState(),setState:(t,s)=>e(this,o).setState(t,s),get:t=>e(this,o).get(t),eventBus:e(this,g),on:(t,s)=>e(this,g).on(t,s),off:(t,s)=>e(this,g).off(t,s),emit:(t,s)=>e(this,g).emit(t,s),intercept:(t,s)=>e(this,g).intercept(t,s),slots:e(this,m),table:this,getOptions:()=>({...e(this,r)}),getNestedValue:(t,s)=>l(this,K,ht).call(this,t,s),getRowId:t=>l(this,E,L).call(this,t),getCellValue:(t,s)=>l(this,$,M).call(this,t,s)}},E=new WeakSet,L=function(t){let{rowId:s}=e(this,r);return typeof s=="function"?String(s(t)):t[s]!==void 0?String(t[s]):(t.__bw_id!==void 0||(t.__bw_id=`bw_${Math.random().toString(36).slice(2,9)}`),t.__bw_id)},$=new WeakSet,M=function(t,s){return s.valueGetter?s.valueGetter(t):s.field?l(this,K,ht).call(this,t,s.field):t[s.id]},J=new WeakSet,gt=function(t){let{isLoading:s,error:i}=t;s?(e(this,m).overlay.innerHTML=`
      <div class="bw-datatable__overlay-content bw-datatable__overlay--loading">
        <span class="bw-datatable__spinner"></span>
        <span class="bw-datatable__overlay-text">${e(this,r).loadingText}</span>
      </div>
    `,e(this,m).overlay.classList.add("bw-datatable__overlay--visible")):i?(e(this,m).overlay.innerHTML=`
      <div class="bw-datatable__overlay-content bw-datatable__overlay--error">
        <span class="bw-datatable__error-icon">\u26A0\uFE0F</span>
        <span class="bw-datatable__overlay-text">${i}</span>
      </div>
    `,e(this,m).overlay.classList.add("bw-datatable__overlay--visible")):(e(this,m).overlay.innerHTML="",e(this,m).overlay.classList.remove("bw-datatable__overlay--visible"))},Pt=new WeakSet,fe=function(t){if(e(this,g).emit("render:header",{state:t,slot:e(this,m).header})===!1)return;let{columns:i,sort:n,selected:a,columnWidths:d}=t,h=e(this,r).paginated?t.page*t.pageSize:0,f=e(this,r).paginated?h+t.pageSize:t.rows.length,b=t.rows.slice(h,f),w=b.length>0&&b.every(c=>a.has(l(this,E,L).call(this,c))),_="<tr>";e(this,r).selectable&&t.selectionMode!=="none"&&(_+=`<th class="bw-datatable__th bw-datatable__th--checkbox">
      <input type="checkbox" data-select-all ${w?"checked":""}>
    </th>`);for(let c of i){if(t.hiddenColumns?.includes(c.id))continue;let S=n.find(O=>O.column===c.id),v=S?`bw-datatable__th--sort-${S.dir}`:"",P=e(this,r).sortable&&c.sortable!==!1,W=e(this,r).resizable&&c.resizable!==!1,V=d?.[c.id]||c.width,D=V?`width: ${V}px; min-width: ${V}px;`:"";_+=`
      <th class="bw-datatable__th ${v} ${P?"bw-datatable__th--sortable":""}"
          data-column="${c.id}"
          style="${D}">
        <span class="bw-datatable__th-content">${c.header||c.id}</span>
        ${P?'<span class="bw-datatable__th-sort"></span>':""}
        ${W?'<span class="bw-datatable__resize-handle" data-resize="'+c.id+'"></span>':""}
      </th>
    `}_+="</tr>",e(this,m).header.innerHTML=_},Dt=new WeakSet,be=function(t){if(e(this,g).emit("render:body",{state:t,slot:e(this,m).body})===!1)return;let{rows:i,columns:n,selected:a,columnWidths:d}=t,h=e(this,r).paginated?t.page*t.pageSize:0,f=e(this,r).paginated?h+t.pageSize:i.length,b=i.slice(h,f),_=n.filter(S=>!t.hiddenColumns?.includes(S.id)).length+(e(this,r).selectable&&t.selectionMode!=="none"?1:0),c="";for(let S of b){let v=l(this,E,L).call(this,S),P=a.has(v);c+=`<tr class="bw-datatable__row ${P?"bw-datatable__row--selected":""}" data-row-id="${v}">`,e(this,r).selectable&&t.selectionMode!=="none"&&(c+=`<td class="bw-datatable__td bw-datatable__td--checkbox">
        <input type="checkbox" ${P?"checked":""} data-select-row="${v}">
      </td>`);for(let W of n){if(t.hiddenColumns?.includes(W.id))continue;let V=l(this,$,M).call(this,S,W),D=l(this,It,ge).call(this,V,W),O=d?.[W.id]||W.width,pe=O?`width: ${O}px; min-width: ${O}px; max-width: ${O}px;`:"";c+=`<td class="bw-datatable__td" data-cell="${W.id}" style="${pe}">${D}</td>`}c+="</tr>"}if(e(this,m).body.innerHTML=c,!b.length){let S=e(this,r).emptyText||"No data available";e(this,m).body.innerHTML=`
    <tr class="bw-datatable__row--empty">
      <td colspan="${_}">
        <div class="bw-datatable__empty">
          <span class="bw-datatable__empty-icon">\u{1F4ED}</span>
          <span class="bw-datatable__empty-text">${S}</span>
        </div>
      </td>
    </tr>
  `;return}},It=new WeakSet,ge=function(t,s){if(s.formatter)return s.formatter(t,s);if(t==null)return"";switch(s.type){case"number":return Number(t).toLocaleString();case"boolean":return t?"\u2713":"\u2717";case"date":return new Date(t).toLocaleDateString();default:return String(t)}},Rt=new WeakSet,me=function(t){if(e(this,g).emit("render:footer",{state:t,slot:e(this,m).footer})===!1)return;if(!e(this,r).paginated){e(this,m).footer.innerHTML="";return}let{page:i,pageSize:n,totalRows:a}=t,d=Math.ceil(a/n),h=a===0?0:i*n+1,f=Math.min((i+1)*n,a);e(this,m).footer.innerHTML=`
      <div class="bw-datatable__pagination">
        <div class="bw-datatable__pagination-info">
          Showing ${h} to ${f} of ${a} entries
        </div>
        <div class="bw-datatable__pagination-controls">
          <button class="bw-datatable__pagination-btn" data-page="first" ${i===0?"disabled":""}>\xAB</button>
          <button class="bw-datatable__pagination-btn" data-page="prev" ${i===0?"disabled":""}>\u2039</button>
          <span class="bw-datatable__pagination-pages">Page ${i+1} of ${d||1}</span>
          <button class="bw-datatable__pagination-btn" data-page="next" ${i>=d-1?"disabled":""}>\u203A</button>
          <button class="bw-datatable__pagination-btn" data-page="last" ${i>=d-1?"disabled":""}>\xBB</button>
        </div>
      </div>
    `};return ve(ke);})();
BWDataTable=BWDataTable.BWDataTable;
