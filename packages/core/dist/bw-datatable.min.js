var BWDataTable=(()=>{var ee=Object.defineProperty;var We=Object.getOwnPropertyDescriptor;var ze=Object.getOwnPropertyNames;var Re=Object.prototype.hasOwnProperty;var He=(p,e)=>{for(var s in e)ee(p,s,{get:e[s],enumerable:!0})},Ae=(p,e,s,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ze(e))!Re.call(p,r)&&r!==s&&ee(p,r,{get:()=>e[r],enumerable:!(n=We(e,r))||n.enumerable});return p};var Me=p=>Ae(ee({},"__esModule",{value:!0}),p);var se=(p,e,s)=>{if(!e.has(p))throw TypeError("Cannot "+s)};var t=(p,e,s)=>(se(p,e,"read from private field"),s?s.call(p):e.get(p)),h=(p,e,s)=>{if(e.has(p))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(p):e.set(p,s)},a=(p,e,s,n)=>(se(p,e,"write to private field"),n?n.call(p,s):e.set(p,s),s);var i=(p,e,s)=>(se(p,e,"access private method"),s);var Oe={};He(Oe,{BWDataTable:()=>ut,EventBus:()=>Jt,PluginSystem:()=>Qt,StateManager:()=>Yt,default:()=>ut});var j,u,S,C,b,T,k,tt,et,W,K,A,kt,N,st,R,H,f,ht,_,O,gt,I,L,X,M,U,_t,q,Dt,oe,yt,ie,xt,ne,J,lt,Wt,ce,zt,de,Rt,ue,Ht,fe,At,be,it,dt,Mt,pe,Nt,we,Ot,me,E,D,Pt,ge,qt,_e,he,Ne,Y,at,pt,Et,Bt,ye,Vt,xe,St,re,Ft,Se,w,m,B,G,jt,ve,wt,$t,Kt,Te,V,Q,vt,le,Tt,ae,Xt,Ie,y,x,Ut,Ce,ut=class{constructor(e,s={}){h(this,Dt);h(this,yt);h(this,xt);h(this,J);h(this,Wt);h(this,zt);h(this,Rt);h(this,Ht);h(this,At);h(this,it);h(this,Mt);h(this,Nt);h(this,Ot);h(this,E);h(this,Pt);h(this,qt);h(this,he);h(this,Y);h(this,pt);h(this,Bt);h(this,Vt);h(this,St);h(this,Ft);h(this,w);h(this,B);h(this,jt);h(this,wt);h(this,Kt);h(this,V);h(this,vt);h(this,Tt);h(this,Xt);h(this,y);h(this,Ut);h(this,j,null);h(this,u,[]);h(this,S,[]);h(this,C,[]);h(this,b,{});h(this,T,new Set);h(this,k,{column:null,direction:null});h(this,tt,"");h(this,et,{});h(this,W,0);h(this,K,0);h(this,A,40);h(this,kt,20);h(this,N,null);h(this,st,null);h(this,R,null);h(this,H,null);h(this,f,null);h(this,ht,null);h(this,_,{start:0,end:0});h(this,O,{});h(this,gt,[]);h(this,I,null);h(this,L,null);h(this,X,!1);h(this,M,new Map);h(this,U,null);h(this,_t,1e4);h(this,q,null);if(a(this,j,typeof e=="string"?document.querySelector(e):e),!t(this,j))throw new Error(`BWDataTable: Container "${e}" not found`);a(this,b,{data:[],columns:null,rowHeight:40,bufferSize:20,rowId:"id",sortable:!0,filterable:!0,selectable:!0,editable:!0,resizable:!0,...s}),a(this,A,t(this,b).rowHeight),a(this,kt,t(this,b).bufferSize),a(this,I,null),a(this,L,null),i(this,Wt,ce).call(this)}sort(e,s="asc"){a(this,k,{column:s?e:null,direction:s}),i(this,J,lt).call(this,()=>{i(this,V,Q).call(this),i(this,it,dt).call(this),t(this,f).scrollTop=0,a(this,W,0),a(this,_,{start:-1,end:-1}),i(this,w,m).call(this,!0),i(this,y,x).call(this,"sort",{column:e,direction:s}),i(this,y,x).call(this,"sort:after",{column:e,direction:s})})}filter(e){a(this,tt,e?.toLowerCase()||""),i(this,J,lt).call(this,()=>{i(this,V,Q).call(this),t(this,f).scrollTop=0,a(this,W,0),a(this,_,{start:-1,end:-1}),i(this,w,m).call(this,!0),i(this,y,x).call(this,"filter",{term:e}),i(this,y,x).call(this,"filter:after",{term:e,count:t(this,S).length})})}filterColumn(e,s){s===""||s===null||s===void 0?delete t(this,et)[e]:t(this,et)[e]=s,i(this,J,lt).call(this,()=>{i(this,V,Q).call(this),t(this,f).scrollTop=0,a(this,W,0),a(this,_,{start:-1,end:-1}),i(this,w,m).call(this,!0)})}clearFilters(){a(this,tt,""),a(this,et,{});let e=t(this,N).querySelector(".bw-datatable__search");e&&(e.value=""),i(this,J,lt).call(this,()=>{i(this,V,Q).call(this),t(this,f).scrollTop=0,a(this,W,0),a(this,_,{start:-1,end:-1}),i(this,w,m).call(this,!0),i(this,y,x).call(this,"filter:clear")})}clearSort(){a(this,k,{column:null,direction:null}),i(this,J,lt).call(this,()=>{i(this,V,Q).call(this),i(this,it,dt).call(this),t(this,f).scrollTop=0,a(this,W,0),a(this,_,{start:-1,end:-1}),i(this,w,m).call(this,!0),i(this,y,x).call(this,"sort:clear")})}reset(){a(this,tt,""),a(this,et,{}),a(this,k,{column:null,direction:null});let e=t(this,N).querySelector(".bw-datatable__search");e&&(e.value=""),i(this,J,lt).call(this,()=>{i(this,V,Q).call(this),i(this,it,dt).call(this),t(this,f).scrollTop=0,a(this,W,0),a(this,_,{start:-1,end:-1}),i(this,w,m).call(this,!0),i(this,y,x).call(this,"reset")})}selectAll(){i(this,Tt,ae).call(this,!0)}clearSelection(){t(this,T).clear(),i(this,w,m).call(this,!0),i(this,y,x).call(this,"selection:change",{selected:[],count:0})}getSelected(){return t(this,S).map(e=>t(this,u)[e]).filter(e=>t(this,T).has(i(this,B,G).call(this,e,t(this,u).indexOf(e))))}getSelectedIds(){return Array.from(t(this,T))}setData(e){a(this,u,e||[]),t(this,T).clear(),t(this,u).length>t(this,_t)?(i(this,yt,ie).call(this),setTimeout(()=>{i(this,V,Q).call(this),t(this,f).scrollTop=0,a(this,W,0),a(this,_,{start:-1,end:-1}),i(this,w,m).call(this,!0),i(this,xt,ne).call(this)},10)):(i(this,V,Q).call(this),t(this,f).scrollTop=0,a(this,W,0),a(this,_,{start:-1,end:-1}),i(this,w,m).call(this,!0))}getData(){return t(this,u)}getFilteredData(){return t(this,S).map(e=>t(this,u)[e])}getRowCount(){return{total:t(this,u).length,filtered:t(this,S).length}}scrollToRow(e){let s=e*t(this,A);t(this,f).scrollTop=s}scrollToTop(){t(this,f).scrollTop=0}scrollToBottom(){t(this,f).scrollTop=t(this,S).length*t(this,A)}updateCell(e,s,n){let r=t(this,u).findIndex((g,v)=>i(this,B,G).call(this,g,v)===String(e));if(r===-1)return!1;let l=t(this,u)[r],o=t(this,C).find(g=>g.id===s);if(!o)return!1;let c=o.field||o.id,d=l[c];return l[c]=n,a(this,_,{start:-1,end:-1}),i(this,w,m).call(this,!0),i(this,y,x).call(this,"cell:edit",{rowId:e,columnId:s,field:c,oldValue:d,newValue:n,row:{...l}}),!0}getRowById(e){let s=t(this,u).findIndex((n,r)=>i(this,B,G).call(this,n,r)===String(e));return s===-1?null:{...t(this,u)[s]}}updateRow(e,s){let n=t(this,u).findIndex((l,o)=>i(this,B,G).call(this,l,o)===String(e));if(n===-1)return!1;let r={...t(this,u)[n]};return t(this,u)[n]={...t(this,u)[n],...s},a(this,_,{start:-1,end:-1}),i(this,w,m).call(this,!0),i(this,y,x).call(this,"row:update",{rowId:e,oldRow:r,newRow:{...t(this,u)[n]}}),!0}getState(){return{data:t(this,u),view:t(this,S),columns:t(this,C),selected:Array.from(t(this,T)),sort:{...t(this,k)},globalFilter:t(this,tt),columnFilters:{...t(this,et)},columnWidths:Object.fromEntries(t(this,M)),rowCount:t(this,S).length,totalCount:t(this,u).length}}setColumnWidth(e,s){t(this,M).set(e,s),i(this,it,dt).call(this),a(this,_,{start:-1,end:-1}),i(this,w,m).call(this),i(this,y,x).call(this,"column:resize",{columnId:e,width:s})}getColumnWidth(e){return t(this,M).get(e)}getColumnWidths(){return Object.fromEntries(t(this,M))}resetColumnWidths(){t(this,M).clear(),i(this,it,dt).call(this),a(this,_,{start:-1,end:-1}),i(this,w,m).call(this),i(this,y,x).call(this,"column:resize:reset")}destroy(){t(this,j).innerHTML="",a(this,O,{})}on(e,s){return t(this,O)[e]||(t(this,O)[e]=[]),t(this,O)[e].push(s),this}off(e,s){return t(this,O)[e]&&(t(this,O)[e]=t(this,O)[e].filter(n=>n!==s)),this}use(e,s={}){let n=i(this,Ut,Ce).call(this,s);try{if(typeof e=="function"){let r=new e(this,s);r.init&&r.init(n),t(this,gt).push(r)}else e&&typeof e.init=="function"?(e.init(n),t(this,gt).push(e)):console.warn("BWDataTable: Invalid plugin format",e)}catch(r){console.error("BWDataTable: Plugin initialization failed",r)}return this}};j=new WeakMap,u=new WeakMap,S=new WeakMap,C=new WeakMap,b=new WeakMap,T=new WeakMap,k=new WeakMap,tt=new WeakMap,et=new WeakMap,W=new WeakMap,K=new WeakMap,A=new WeakMap,kt=new WeakMap,N=new WeakMap,st=new WeakMap,R=new WeakMap,H=new WeakMap,f=new WeakMap,ht=new WeakMap,_=new WeakMap,O=new WeakMap,gt=new WeakMap,I=new WeakMap,L=new WeakMap,X=new WeakMap,M=new WeakMap,U=new WeakMap,_t=new WeakMap,q=new WeakMap,Dt=new WeakSet,oe=function(){a(this,q,document.createElement("div")),t(this,q).className="bw-datatable__loading",t(this,q).innerHTML='<div class="bw-datatable__spinner"></div>',t(this,N).appendChild(t(this,q))},yt=new WeakSet,ie=function(){t(this,q)&&t(this,q).classList.add("bw-datatable__loading--visible")},xt=new WeakSet,ne=function(){t(this,q)&&t(this,q).classList.remove("bw-datatable__loading--visible")},J=new WeakSet,lt=function(e){t(this,u).length>t(this,_t)?(i(this,yt,ie).call(this),setTimeout(()=>{e(),i(this,xt,ne).call(this)},10)):e()},Wt=new WeakSet,ce=function(){a(this,u,t(this,b).data||[]),a(this,S,t(this,u).map((e,s)=>s)),a(this,C,t(this,b).columns||i(this,zt,de).call(this)),i(this,At,be).call(this),i(this,Dt,oe).call(this),i(this,Mt,pe).call(this),i(this,St,re).call(this),i(this,w,m).call(this,!0)},zt=new WeakSet,de=function(){if(t(this,u).length===0)return[];let e=t(this,u)[0];return Object.keys(e).map(s=>({id:s,field:s,header:i(this,Rt,ue).call(this,s),type:i(this,Ht,fe).call(this,e[s]),sortable:!0,filterable:!0}))},Rt=new WeakSet,ue=function(e){return e.replace(/([A-Z])/g," $1").replace(/^./,s=>s.toUpperCase()).replace(/_/g," ").trim()},Ht=new WeakSet,fe=function(e){return typeof e=="number"?"number":typeof e=="boolean"?"boolean":e instanceof Date||typeof e=="string"&&!isNaN(Date.parse(e))?"date":"string"},At=new WeakSet,be=function(){if(t(this,j).innerHTML="",a(this,N,document.createElement("div")),t(this,N).className="bw-datatable",t(this,b).filterable){let e=document.createElement("div");e.className="bw-datatable__toolbar",e.innerHTML=`
        <input type="text" 
          class="bw-datatable__search" 
          placeholder="Search...">
      `,t(this,N).appendChild(e)}a(this,f,document.createElement("div")),t(this,f).className="bw-datatable__scroll-container",t(this,f).style.cssText=`
      height: 400px;
      overflow-y: auto;
      overflow-x: auto;
      position: relative;
    `,a(this,ht,document.createElement("div")),t(this,ht).className="bw-datatable__spacer",t(this,ht).style.cssText=`
      position: absolute;
      top: 0;
      left: 0;
      width: 1px;
      pointer-events: none;
    `,a(this,st,document.createElement("table")),t(this,st).className="bw-datatable__table",t(this,st).style.cssText=`
      width: 100%;
      border-collapse: collapse;
      position: relative;
    `,a(this,R,document.createElement("thead")),t(this,R).className="bw-datatable__header",t(this,R).style.cssText=`
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--bw-dt-header-bg, #f9fafb);
    `,a(this,H,document.createElement("tbody")),t(this,H).className="bw-datatable__body",t(this,st).appendChild(t(this,R)),t(this,st).appendChild(t(this,H)),t(this,f).appendChild(t(this,ht)),t(this,f).appendChild(t(this,st)),t(this,N).appendChild(t(this,f)),t(this,j).appendChild(t(this,N)),i(this,it,dt).call(this)},it=new WeakSet,dt=function(){let e='<tr class="bw-datatable__header-row">';t(this,b).selectable&&(e+=`
        <th class="bw-datatable__th bw-datatable__th--checkbox" style="width:48px;">
          <input type="checkbox" class="bw-datatable__select-all">
        </th>
      `);for(let s of t(this,C)){let n=t(this,b).sortable&&s.sortable!==!1,r=t(this,k).column===s.id?`bw-datatable__th--sort-${t(this,k).direction}`:"",l=t(this,M).get(s.id)||s.width||"auto",o=l!=="auto"?`width:${typeof l=="number"?l+"px":l};`:"",c=s.minWidth||50,d=`min-width:${typeof c=="number"?c+"px":c};`;e+=`
        <th class="bw-datatable__th ${r} ${n?"bw-datatable__th--sortable":""}"
            data-column="${s.id}"
            style="${o}${d}">
          <span class="bw-datatable__th-content">
            <span class="bw-datatable__th-text">${i(this,wt,$t).call(this,s.header||s.id)}</span>
            ${n?'<span class="bw-datatable__th-sort"></span>':""}
          </span>
          ${t(this,b).resizable!==!1?`<div class="bw-datatable__resize-handle" data-column="${s.id}"></div>`:""}
        </th>
      `}e+="</tr>",t(this,R).innerHTML=e},Mt=new WeakSet,pe=function(){t(this,f).addEventListener("scroll",i(this,Nt,we).bind(this)),new ResizeObserver(()=>{i(this,St,re).call(this),i(this,w,m).call(this)}).observe(t(this,f));let s=!1;t(this,b).resizable!==!1&&(t(this,R).addEventListener("mousedown",r=>{let l=r.target.closest(".bw-datatable__resize-handle");if(l){r.preventDefault(),r.stopPropagation();let o=l.dataset.column,d=l.closest("th").offsetWidth,g=t(this,C).findIndex(v=>v.id===o);a(this,U,{columnId:o,startX:r.clientX,startWidth:d,colIndex:g}),document.body.style.cursor="col-resize",document.body.style.userSelect="none",t(this,j).classList.add("bw-datatable--resizing")}}),t(this,R).addEventListener("dblclick",r=>{let l=r.target.closest(".bw-datatable__resize-handle");if(l){r.preventDefault(),r.stopPropagation();let o=l.dataset.column;t(this,M).delete(o);let c=t(this,R).querySelector(`[data-column="${o}"]`);c&&(c.style.width="",c.style.minWidth=""),a(this,_,{start:-1,end:-1}),i(this,w,m).call(this,!0),i(this,y,x).call(this,"column:resize:reset",{columnId:o})}}),document.addEventListener("mousemove",r=>{if(!t(this,U))return;let{columnId:l,startX:o,startWidth:c,colIndex:d}=t(this,U),g=r.clientX-o,v=t(this,C)[d],nt=v?.minWidth||20,rt=v?.maxWidth||2e3,P=Math.max(nt,Math.min(rt,c+g)),bt=t(this,R).querySelector(`[data-column="${l}"]`);bt&&(bt.style.width=`${P}px`,bt.style.minWidth=`${P}px`),t(this,H).querySelectorAll(`[data-col-index="${d}"]`).forEach(mt=>{mt.style.width=`${P}px`,mt.style.minWidth=`${P}px`}),t(this,U).newWidth=P}),document.addEventListener("mouseup",()=>{if(t(this,U)){let{columnId:r,newWidth:l}=t(this,U);l&&t(this,M).set(r,l),a(this,U,null),s=!0,document.body.style.cursor="",document.body.style.userSelect="",t(this,j).classList.remove("bw-datatable--resizing"),i(this,y,x).call(this,"column:resize",{columnId:r,width:t(this,M).get(r)}),setTimeout(()=>{s=!1},100)}})),t(this,R).addEventListener("click",r=>{if(r.target.closest(".bw-datatable__resize-handle")||s)return;let l=r.target.closest("[data-column]");if(l&&t(this,b).sortable){let o=l.dataset.column,c=t(this,C).find(d=>d.id===o);c&&c.sortable!==!1&&i(this,Kt,Te).call(this,o)}r.target.classList.contains("bw-datatable__select-all")&&i(this,Tt,ae).call(this,r.target.checked)}),t(this,H).addEventListener("click",r=>{let l=r.target.closest(".bw-datatable__row-checkbox");if(l){i(this,vt,le).call(this,l.dataset.rowId,l.checked);return}let o=r.target.closest(".bw-datatable__td");if(o&&!o.classList.contains("bw-datatable__td--checkbox")){let d=o.closest(".bw-datatable__row");if(d&&t(this,b).editable){let g=parseInt(d.dataset.viewIndex),v=Array.from(o.parentNode.children).indexOf(o),nt=t(this,b).selectable?v-1:v;t(this,L)&&t(this,L).rowIndex===g&&t(this,L).colIndex===nt?i(this,Y,at).call(this,g,nt):i(this,E,D).call(this,g,nt);return}}let c=r.target.closest(".bw-datatable__row");if(c&&t(this,b).selectable&&!t(this,b).editable){let d=c.dataset.rowId;i(this,vt,le).call(this,d,!t(this,T).has(d))}}),t(this,H).addEventListener("dblclick",r=>{if(!t(this,b).editable)return;let l=r.target.closest(".bw-datatable__td");if(l&&!l.classList.contains("bw-datatable__td--checkbox")){let o=l.closest(".bw-datatable__row");if(o){let c=Array.from(l.parentNode.children).indexOf(l),d=t(this,b).selectable?c-1:c;i(this,Y,at).call(this,o.dataset.viewIndex,d)}}});let n=t(this,N).querySelector(".bw-datatable__search");if(n){let r;n.addEventListener("input",l=>{clearTimeout(r),r=setTimeout(()=>{this.filter(l.target.value)},200)})}t(this,f).tabIndex=0,t(this,f).addEventListener("keydown",i(this,Ot,me).bind(this))},Nt=new WeakSet,we=function(){a(this,W,t(this,f).scrollTop),i(this,w,m).call(this)},Ot=new WeakSet,me=function(e){let s=t(this,S).length*t(this,A),n=t(this,S).length,r=t(this,C).length;if(!t(this,I)){if(t(this,L)){let{rowIndex:l,colIndex:o}=t(this,L);switch(e.key){case"Tab":e.preventDefault(),e.shiftKey?o>0?i(this,E,D).call(this,l,o-1):l>0&&i(this,E,D).call(this,l-1,r-1):o<r-1?i(this,E,D).call(this,l,o+1):l<n-1&&i(this,E,D).call(this,l+1,0);return;case"Enter":e.preventDefault(),t(this,b).editable&&i(this,Y,at).call(this,l,o);return;case"ArrowUp":e.preventDefault(),l>0&&i(this,E,D).call(this,l-1,o);return;case"ArrowDown":e.preventDefault(),l<n-1&&i(this,E,D).call(this,l+1,o);return;case"ArrowLeft":e.preventDefault(),o>0&&i(this,E,D).call(this,l,o-1);return;case"ArrowRight":e.preventDefault(),o<r-1&&i(this,E,D).call(this,l,o+1);return;case"Escape":e.preventDefault(),i(this,Pt,ge).call(this);return}}switch(e.key){case"Home":e.preventDefault(),t(this,f).scrollTop=0,t(this,b).editable&&i(this,E,D).call(this,0,0);break;case"End":e.preventDefault(),t(this,f).scrollTop=s-t(this,K),t(this,b).editable&&i(this,E,D).call(this,n-1,0);break;case"PageDown":e.preventDefault(),t(this,f).scrollTop+=t(this,K);break;case"PageUp":e.preventDefault(),t(this,f).scrollTop-=t(this,K);break;case"Tab":t(this,b).editable&&!t(this,L)&&(e.preventDefault(),i(this,E,D).call(this,0,0));break}}},E=new WeakSet,D=function(e,s){a(this,L,{rowIndex:parseInt(e),colIndex:parseInt(s)}),i(this,qt,_e).call(this,t(this,L).rowIndex),a(this,_,{start:-1,end:-1}),i(this,w,m).call(this),t(this,f).focus()},Pt=new WeakSet,ge=function(){a(this,L,null),a(this,_,{start:-1,end:-1}),i(this,w,m).call(this),t(this,f).focus()},qt=new WeakSet,_e=function(e){let s=e*t(this,A),n=s+t(this,A),r=t(this,W),l=t(this,W)+t(this,K);s<r?t(this,f).scrollTop=s:n>l&&(t(this,f).scrollTop=n-t(this,K))},he=new WeakSet,Ne=function(e,s){let n=t(this,H).querySelector(`[data-view-index="${e}"]`);return n&&n.querySelectorAll(".bw-datatable__td:not(.bw-datatable__td--checkbox)")[s]||null},Y=new WeakSet,at=function(e,s){if(!t(this,b).editable)return;e=parseInt(e),s=parseInt(s);let n=t(this,S)[e];if(n===void 0)return;let r=t(this,u)[n],l=t(this,C)[s];if(!r||!l||l.editable===!1)return;let o=i(this,B,G).call(this,r,n),c=r[l.field||l.id];a(this,I,{rowId:o,rowIndex:e,colIndex:s,dataIndex:n,columnId:l.id,field:l.field||l.id,originalValue:c}),a(this,_,{start:-1,end:-1}),i(this,w,m).call(this),setTimeout(()=>{let d=t(this,H).querySelector(".bw-datatable__edit-input");d&&(d.focus(),d.select())},0),i(this,y,x).call(this,"cell:edit:start",{rowId:o,rowIndex:e,colIndex:s,columnId:l.id,value:c})},pt=new WeakSet,Et=function(e){if(!t(this,I))return;let{dataIndex:s,field:n,originalValue:r,rowId:l,columnId:o,rowIndex:c,colIndex:d}=t(this,I),g=t(this,u)[s],v=r;g[n]=e,a(this,I,null),a(this,L,{rowIndex:c,colIndex:d}),a(this,_,{start:-1,end:-1}),i(this,w,m).call(this),t(this,f).focus(),i(this,y,x).call(this,"cell:edit",{rowId:l,rowIndex:c,colIndex:d,columnId:o,field:n,oldValue:v,newValue:e,row:{...g}}),i(this,y,x).call(this,"cell:edit:end",{rowId:l,columnId:o,oldValue:v,newValue:e})},Bt=new WeakSet,ye=function(){if(!t(this,I))return;let{rowIndex:e,colIndex:s}=t(this,I);a(this,I,null),a(this,L,{rowIndex:e,colIndex:s}),a(this,_,{start:-1,end:-1}),i(this,w,m).call(this),t(this,f).focus(),i(this,y,x).call(this,"cell:edit:cancel")},Vt=new WeakSet,xe=function(e){if(!t(this,I))return;let s=e.target,{rowIndex:n,colIndex:r}=t(this,I),l=t(this,C).length,o=t(this,S).length;switch(e.key){case"Enter":e.preventDefault(),e.stopPropagation(),a(this,X,!0),i(this,pt,Et).call(this,s.value),n<o-1&&i(this,E,D).call(this,n+1,r),a(this,X,!1);break;case"Tab":e.preventDefault(),e.stopPropagation(),a(this,X,!0),i(this,pt,Et).call(this,s.value),e.shiftKey?r>0?i(this,Y,at).call(this,n,r-1):n>0?i(this,Y,at).call(this,n-1,l-1):i(this,E,D).call(this,n,r):r<l-1?i(this,Y,at).call(this,n,r+1):n<o-1?i(this,Y,at).call(this,n+1,0):i(this,E,D).call(this,n,r),a(this,X,!1);break;case"Escape":e.preventDefault(),e.stopPropagation(),a(this,X,!0),i(this,Bt,ye).call(this),a(this,X,!1);break}},St=new WeakSet,re=function(){a(this,K,t(this,f).clientHeight)},Ft=new WeakSet,Se=function(){let e=t(this,S).length,s=Math.floor(t(this,W)/t(this,A)),n=Math.ceil(t(this,K)/t(this,A)),r=n,l=Math.max(0,s-r),o=Math.min(e,s+n+r);return{start:l,end:o,visibleStart:s,visibleCount:n}},w=new WeakSet,m=function(e=!1){let n=t(this,S).length*t(this,A);t(this,ht).style.height=`${n}px`;let r=i(this,Ft,Se).call(this);if(!e&&r.start===t(this,_).start&&r.end===t(this,_).end)return;a(this,_,r);let l=r.start*t(this,A),o="";for(let c=r.start;c<r.end;c++){let d=t(this,S)[c],g=t(this,u)[d],v=i(this,B,G).call(this,g,d),nt=t(this,T).has(v);o+=`<tr class="bw-datatable__row ${nt?"bw-datatable__row--selected":""}" data-row-id="${v}" data-view-index="${c}">`,t(this,b).selectable&&(o+=`
          <td class="bw-datatable__td bw-datatable__td--checkbox">
            <input type="checkbox" 
              class="bw-datatable__row-checkbox" 
              data-row-id="${v}"
              ${nt?"checked":""}>
          </td>
        `);for(let rt=0;rt<t(this,C).length;rt++){let P=t(this,C)[rt],bt=g[P.field||P.id],te=t(this,L)&&t(this,L).rowIndex===c&&t(this,L).colIndex===rt,mt=t(this,I)&&t(this,I).rowIndex===c&&t(this,I).colIndex===rt,$e=te?"bw-datatable__td--focused":"",ke=mt?"bw-datatable__td--editing":"",Ct=t(this,M).get(P.id)||P.width,De=Ct?`width:${typeof Ct=="number"?Ct+"px":Ct};`:"";if(o+=`<td class="bw-datatable__td ${$e} ${ke}" 
                     tabindex="${te?"0":"-1"}"
                     data-col-index="${rt}"
                     style="${De}">`,mt){let Lt=i(this,wt,$t).call(this,String(bt??""));o+=`<input type="text" 
                          class="bw-datatable__edit-input" 
                          value="${Lt.replace(/"/g,"&quot;")}"
                          data-original="${Lt.replace(/"/g,"&quot;")}">`}else{let Lt=i(this,jt,ve).call(this,bt,P,g);o+=Lt}o+="</td>"}o+="</tr>"}if(t(this,H).innerHTML=o,t(this,H).style.transform=`translateY(${l}px)`,t(this,I)){let c=t(this,H).querySelector(".bw-datatable__edit-input");c&&(c.addEventListener("keydown",d=>i(this,Vt,xe).call(this,d)),c.addEventListener("blur",d=>{t(this,I)&&!t(this,X)&&i(this,pt,Et).call(this,d.target.value)}))}i(this,Xt,Ie).call(this)},B=new WeakSet,G=function(e,s){let n=t(this,b).rowId;return String(typeof n=="function"?n(e,s):e[n]??`__row_${s}`)},jt=new WeakSet,ve=function(e,s,n){if(e==null)return"";if(s.render&&typeof s.render=="function")return s.render(e,n,s);switch(s.type){case"boolean":return e?"\u2713":"\u2717";case"number":return typeof e=="number"?e.toLocaleString():e;case"date":return e instanceof Date?e.toLocaleDateString():String(e);default:return i(this,wt,$t).call(this,String(e))}},wt=new WeakSet,$t=function(e){let s=document.createElement("div");return s.textContent=e,s.innerHTML},Kt=new WeakSet,Te=function(e){let s="asc";t(this,k).column===e&&(t(this,k).direction==="asc"?s="desc":t(this,k).direction==="desc"&&(s=null)),this.sort(e,s)},V=new WeakSet,Q=function(){let e=t(this,u).map((s,n)=>n);if(t(this,tt)){let s=t(this,tt);e=e.filter(n=>{let r=t(this,u)[n];return t(this,C).some(l=>{let o=r[l.field||l.id];return String(o??"").toLowerCase().includes(s)})})}for(let[s,n]of Object.entries(t(this,et))){let r=t(this,C).find(c=>c.id===s);if(!r)continue;let l=r.field||r.id,o=String(n).toLowerCase();e=e.filter(c=>{let d=t(this,u)[c][l];return String(d??"").toLowerCase().includes(o)})}if(t(this,k).column&&t(this,k).direction){let s=t(this,C).find(o=>o.id===t(this,k).column),n=s?.field||t(this,k).column,r=t(this,k).direction==="asc"?1:-1,l=s?.type||"string";e.sort((o,c)=>{let d=t(this,u)[o][n],g=t(this,u)[c][n];if(d==null&&g==null)return 0;if(d==null)return 1;if(g==null)return-1;let v;switch(l){case"number":v=Number(d)-Number(g);break;case"date":v=new Date(d).getTime()-new Date(g).getTime();break;default:v=String(d).localeCompare(String(g))}return v*r})}a(this,S,e)},vt=new WeakSet,le=function(e,s){s?t(this,T).add(e):t(this,T).delete(e),i(this,w,m).call(this,!0),i(this,y,x).call(this,"selection:change",{selected:Array.from(t(this,T)),count:t(this,T).size})},Tt=new WeakSet,ae=function(e){i(this,J,lt).call(this,()=>{e?t(this,S).forEach(s=>{let n=t(this,u)[s],r=i(this,B,G).call(this,n,s);t(this,T).add(r)}):t(this,T).clear(),i(this,w,m).call(this,!0),i(this,y,x).call(this,"selection:change",{selected:Array.from(t(this,T)),count:t(this,T).size})})},Xt=new WeakSet,Ie=function(){let e=t(this,R).querySelector(".bw-datatable__select-all");if(!e)return;let s=t(this,S).length,n=t(this,S).filter(r=>{let l=t(this,u)[r],o=i(this,B,G).call(this,l,r);return t(this,T).has(o)}).length;e.checked=s>0&&n===s,e.indeterminate=n>0&&n<s},y=new WeakSet,x=function(e,s={}){t(this,O)[e]&&t(this,O)[e].forEach(n=>n(s))},Ut=new WeakSet,Ce=function(e){return{table:this,eventBus:{on:(s,n)=>this.on(s,n),off:(s,n)=>this.off(s,n),emit:(s,n)=>i(this,y,x).call(this,s,n)},getState:()=>this.getState(),getOptions:()=>({...t(this,b)}),options:e}};typeof module<"u"&&module.exports?module.exports={BWDataTable:ut}:typeof window<"u"&&(window.BWDataTable=ut);var F,Z,Jt=class{constructor(){h(this,F,new Map);h(this,Z,new Map)}on(e,s){return t(this,F).has(e)||t(this,F).set(e,new Set),t(this,F).get(e).add(s),()=>this.off(e,s)}off(e,s){t(this,F).has(e)&&t(this,F).get(e).delete(s)}emit(e,s){if(t(this,Z).has(e))for(let n of t(this,Z).get(e)){let r=n(s);if(r===!1)return!1;r!==void 0&&(s=r)}if(t(this,F).has(e))for(let n of t(this,F).get(e))n(s);return s}intercept(e,s){return t(this,Z).has(e)||t(this,Z).set(e,new Set),t(this,Z).get(e).add(s),()=>t(this,Z).get(e).delete(s)}clear(){t(this,F).clear(),t(this,Z).clear()}};F=new WeakMap,Z=new WeakMap;function Le(){return{data:[],rows:[],columns:[],columnOrder:[],columnWidths:{},pinnedLeft:[],pinnedRight:[],hiddenColumns:[],sort:[],filters:{},globalFilter:"",selected:new Set,selectionMode:"multi",page:0,pageSize:20,totalRows:0,editingCell:null,editingRow:null,isLoading:!1,error:null}}var $,ot,ct,Zt,Gt,Ee,Yt=class{constructor(e,s={}){h(this,Gt);h(this,$,void 0);h(this,ot,void 0);h(this,ct,[]);h(this,Zt,50);a(this,ot,e),a(this,$,{...Le(),...s})}getState(){return{...t(this,$)}}get(e){return t(this,$)[e]}setState(e,s={}){let{silent:n=!1,track:r=!0}=s;r&&i(this,Gt,Ee).call(this);let l=t(this,$);a(this,$,{...t(this,$),...e}),n||t(this,ot).emit("state:change",{prev:l,current:t(this,$),changes:Object.keys(e)})}reset(e={}){a(this,$,{...Le(),...e}),a(this,ct,[]),t(this,ot).emit("state:reset",t(this,$))}getHistory(){return t(this,ct)}restore(e){a(this,$,{...e,selected:new Set(e.selected)}),t(this,ot).emit("state:restore",t(this,$))}batch(e){let s=t(this,$);e(),t(this,ot).emit("state:change",{prev:s,current:t(this,$),changes:["batch"]})}};$=new WeakMap,ot=new WeakMap,ct=new WeakMap,Zt=new WeakMap,Gt=new WeakSet,Ee=function(){let e=JSON.parse(JSON.stringify({...t(this,$),selected:[...t(this,$).selected]}));t(this,ct).push(e),t(this,ct).length>t(this,Zt)&&t(this,ct).shift()};var z,It,ft,Qt=class{constructor(e){h(this,z,new Map);h(this,It,null);h(this,ft,void 0);a(this,ft,e)}setAPI(e){a(this,It,e)}register(e,s={}){let{name:n,init:r,dependencies:l=[]}=e;if(!n)throw new Error("Plugin must have a name");if(t(this,z).has(n))return console.warn(`Plugin "${n}" already registered, skipping`),t(this,z).get(n).instance;if(typeof r!="function")throw new Error(`Plugin "${n}" must have init function`);for(let c of l)if(!t(this,z).has(c))throw new Error(`Plugin "${n}" requires "${c}" plugin`);let o=r({...t(this,It),options:s});return t(this,z).set(n,{plugin:e,instance:o,options:s}),t(this,ft).emit("plugin:registered",{name:n,instance:o}),o}unregister(e){if(!t(this,z).has(e)){console.warn(`Plugin "${e}" not found`);return}let{plugin:s,instance:n}=t(this,z).get(e);typeof s.destroy=="function"&&s.destroy(n),t(this,z).delete(e),t(this,ft).emit("plugin:unregistered",{name:e})}get(e){return t(this,z).get(e)?.instance||null}has(e){return t(this,z).has(e)}list(){return[...t(this,z).keys()]}destroyAll(){for(let[e,{plugin:s,instance:n}]of t(this,z))typeof s.destroy=="function"&&s.destroy(n);t(this,z).clear(),t(this,ft).emit("plugin:destroyedAll")}};z=new WeakMap,It=new WeakMap,ft=new WeakMap;return Me(Oe);})();
BWDataTable=BWDataTable.BWDataTable;
