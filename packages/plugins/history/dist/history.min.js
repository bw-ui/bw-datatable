var BWHistory=(()=>{var S=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var x=(s,e)=>{for(var o in e)S(s,o,{get:e[o],enumerable:!0})},C=(s,e,o,u)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of F(e))!w.call(s,l)&&l!==o&&S(s,l,{get:()=>e[l],enumerable:!(u=R(e,l))||u.enumerable});return s};var z=s=>C(S({},"__esModule",{value:!0}),s);var K={};x(K,{HistoryPlugin:()=>k,default:()=>k});var E={maxHistory:50,shortcuts:!0},k={name:"history",init(s){let{eventBus:e,table:o,options:u}=s;if(!o){console.error("HistoryPlugin: table is undefined");return}let l={...E,...u},r=[],i=[],c=!1,d=null;function U(t){try{return JSON.parse(JSON.stringify(t))}catch(n){return console.error("HistoryPlugin: Failed to clone data",n),t}}function a(t){let n=o.getState();return{data:U(n.data),sort:n.sort?{...n.sort}:{column:null,direction:null},globalFilter:n.globalFilter||"",selected:[...n.selected||[]],_action:t,_timestamp:Date.now()}}function h(t){c||(r.push(t),r.length>l.maxHistory&&r.shift(),i.length=0,f())}function f(){e&&e.emit&&e.emit("history:change",{canUndo:r.length>0,canRedo:i.length>0,undoCount:r.length,redoCount:i.length})}function b(t){c=!0;try{o.setData&&o.setData(U(t.data)),t.sort&&t.sort.column&&o.sort&&o.sort(t.sort.column,t.sort.direction),t.globalFilter&&o.filter&&o.filter(t.globalFilter)}catch(n){console.error("HistoryPlugin: Failed to restore snapshot",n)}c=!1}function y(){if(r.length===0)return!1;let t=a("redo-point");i.push(t);let n=r.pop();return b(n),e&&e.emit&&e.emit("history:undo",{action:n._action}),f(),!0}function g(){if(i.length===0)return!1;let t=a("undo-point");r.push(t);let n=i.pop();return b(n),e&&e.emit&&e.emit("history:redo",{action:n._action}),f(),!0}function p(){return r.length>0}function m(){return i.length>0}function P(){r.length=0,i.length=0,f(),e&&e.emit&&e.emit("history:clear")}function v(){return{undoStack:[...r],redoStack:[...i],canUndo:p(),canRedo:m()}}return e&&e.on&&(e.on("cell:edit:start",t=>{c||(console.log("[History] cell:edit:start - pushing snapshot for:",t.columnId),h(a(`Edit ${t.columnId}`)))}),e.on("selection:change",t=>{c||t.count!==void 0&&(console.log("[History] selection:change - pushing snapshot, count:",t.count),h(a(`Selection (${t.count} rows)`)))}),e.on("edit:before",t=>{c||(console.log("[History] edit:before - pushing snapshot"),h(a("Edit cell")))}),e.on("row:update",t=>{})),l.shortcuts&&(d=t=>{if(!(navigator.platform.toUpperCase().indexOf("MAC")>=0?t.metaKey:t.ctrlKey))return;let H=t.key.toLowerCase();if(H==="z"&&!t.shiftKey){t.preventDefault(),t.stopPropagation(),console.log("[History] Undo triggered, stack size:",r.length);let D=y();console.log("[History] Undo result:",D);return}if(H==="y"){t.preventDefault(),t.stopPropagation(),console.log("[History] Redo (Y) triggered, stack size:",i.length),g();return}if(H==="z"&&t.shiftKey){t.preventDefault(),t.stopPropagation(),console.log("[History] Redo (Shift+Z) triggered, stack size:",i.length),g();return}},document.addEventListener("keydown",d,!0)),o.undo=y,o.redo=g,o.canUndo=p,o.canRedo=m,o.clearHistory=P,o.getHistory=v,{name:"history",undo:y,redo:g,canUndo:p,canRedo:m,clearHistory:P,getHistory:v,destroy(){d&&document.removeEventListener("keydown",d,!0),r.length=0,i.length=0,delete o.undo,delete o.redo,delete o.canUndo,delete o.canRedo,delete o.clearHistory,delete o.getHistory}}}};return z(K);})();
BWHistory=BWHistory.HistoryPlugin;
