var BWHistory=(()=>{var w=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var E=(o,e)=>{for(var a in e)w(o,a,{get:e[a],enumerable:!0})},K=(o,e,a,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of _(e))!R.call(o,l)&&l!==a&&w(o,l,{get:()=>e[l],enumerable:!(i=P(e,l))||i.enumerable});return o};var L=o=>K(w({},"__esModule",{value:!0}),o);var O={};E(O,{HistoryPlugin:()=>b,default:()=>b});var M={maxHistory:50,trackSort:!1,trackFilter:!1,trackSelection:!1,shortcuts:!0},b={name:"history",init(o){let{eventBus:e,stateManager:a,table:i,options:l}=o,d={...M,...l},r=[],s=[],c=null,u=!1,p=null;function g(t){return JSON.parse(JSON.stringify(t))}function f(t){let n=a.getState();return{data:g(n.data),rows:g(n.rows),sort:[...n.sort],filters:{...n.filters},globalFilter:n.globalFilter,selected:[...n.selected],_action:t,_timestamp:Date.now()}}function m(t){u||(r.push(t),r.length>d.maxHistory&&r.shift(),s.length=0,h())}function h(){e.emit("history:change",{canUndo:r.length>0,canRedo:s.length>0,undoCount:r.length,redoCount:s.length})}function v(t){u=!0,a.setState({data:g(t.data),rows:g(t.rows),sort:[...t.sort],filters:{...t.filters},globalFilter:t.globalFilter,selected:new Set(t.selected)},{track:!1,silent:!0}),i.render(),u=!1}function S(){if(r.length===0)return!1;let t=f("redo-point");s.push(t);let n=r.pop();return v(n),e.emit("undo",{action:n._action,timestamp:n._timestamp}),h(),!0}function y(){if(s.length===0)return!1;let t=f("undo-point");r.push(t);let n=s.pop();return v(n),e.emit("redo",{action:n._action,timestamp:n._timestamp}),h(),!0}function k(){return r.length>0}function H(){return s.length>0}function C(){r.length=0,s.length=0,c=null,h(),e.emit("history:cleared")}function F(){return{undoStack:[...r],redoStack:[...s],canUndo:k(),canRedo:H()}}return e.on("edit:before",t=>{u||(c=f(`Edit [${t.rowId}][${t.columnId}]`))}),e.on("edit:end",t=>{u||(c&&t.value!==t.oldValue&&m(c),c=null)}),e.on("edit:cancel",()=>{c=null}),d.trackSort&&e.on("sort:before",()=>{u||m(f("Sort change"))}),d.trackFilter&&e.on("filter:before",()=>{u||m(f("Filter change"))}),d.shortcuts&&(p=t=>{if(t.target.matches("input, textarea, select")||!(navigator.platform.toUpperCase().indexOf("MAC")>=0?t.metaKey:t.ctrlKey))return;let x=t.key.toLowerCase(),U=x==="z"||t.keyCode===90,D=x==="y"||t.keyCode===89;if(U&&!t.shiftKey){t.preventDefault(),t.stopPropagation(),S();return}if(D){t.preventDefault(),t.stopPropagation(),y();return}if(U&&t.shiftKey){t.preventDefault(),t.stopPropagation(),y();return}},document.addEventListener("keydown",p,!0)),i.undo=S,i.redo=y,i.canUndo=k,i.canRedo=H,i.clearHistory=C,i.getHistory=F,{undo:S,redo:y,canUndo:k,canRedo:H,clearHistory:C,getHistory:F,destroy(){p&&document.removeEventListener("keydown",p,!0),r.length=0,s.length=0}}},destroy(o){o&&typeof o.destroy=="function"&&o.destroy()}};return L(O);})();
BWHistory=BWHistory.HistoryPlugin;
