var T={shortcuts:!0,copyHeaders:!1,pasteMode:"replace"},S={name:"clipboard",init(m){let{eventBus:C,table:p,getState:D,options:M}=m,h={...T,...M},w=null;function E(e,a){let t=a.field||a.id,o;return t.includes(".")?o=t.split(".").reduce((i,l)=>i?.[l],e):o=e[t],o==null?"":String(o)}function L(e){return e.trim().split(/\r?\n/).map(t=>t.split("	"))}async function v(e={}){let a={...h,...e},t=p.getSelected();if(t.length===0)return console.warn("ClipboardPlugin: No rows selected"),!1;let o=p.getVisibleColumns(),i=[];if(a.copyHeaders){let f=o.map(s=>s.header||s.id);i.push(f.join("	"))}t.forEach(f=>{let s=o.map(d=>E(f,d));i.push(s.join("	"))});let l=i.join(`
`);try{return await navigator.clipboard.writeText(l),C.emit("clipboard:copy",{rowCount:t.length,content:l}),!0}catch(f){return console.error("ClipboardPlugin: Copy failed",f),!1}}async function P(e={}){let a={...h,...e},t;try{t=await navigator.clipboard.readText()}catch(u){return console.error("ClipboardPlugin: Paste failed - clipboard access denied",u),!1}if(!t.trim())return console.warn("ClipboardPlugin: Clipboard is empty"),!1;let o=L(t),i=p.getVisibleColumns(),l=D();if(C.emit("clipboard:before-paste",{parsedRows:o,columns:i})===!1)return!1;let s=o.map(u=>{let c={};return i.forEach((g,x)=>{if(x<u.length){let k=g.field||g.id,n=u[x];if(g.type==="number"){let r=parseFloat(n);n=isNaN(r)?n:r}else if(g.type==="boolean"){let r=n.toLowerCase();(r==="true"||r==="false"||n==="1"||n==="0"||n==="\u2713")&&(n=r==="true"||n==="1"||n==="\u2713")}if(k.includes(".")){let r=k.split("."),y=c;for(let b=0;b<r.length-1;b++)y[r[b]]=y[r[b]]||{},y=y[r[b]];y[r[r.length-1]]=n}else c[k]=n}}),c.id||(c.id=`paste_${Date.now()}_${Math.random().toString(36).slice(2,9)}`),c}),d;if(a.pasteMode==="append")d=[...l.data,...s];else{let u=new Set(p.getSelectedIds());u.size>0?(d=l.data.filter(c=>{let g=c.id||c.__bw_id;return!u.has(String(g))}),d=[...d,...s]):d=[...l.data,...s]}return p.setData(d),C.emit("clipboard:paste",{rowCount:s.length,rows:s,mode:a.pasteMode}),!0}return h.shortcuts&&(w=e=>{if(e.target.matches("input, textarea, select")||!(navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey))return;let o=e.key.toLowerCase();if(o==="c"||e.keyCode===67){e.preventDefault(),e.stopPropagation(),setTimeout(()=>v(),10);return}if(o==="v"||e.keyCode===86){e.preventDefault(),e.stopPropagation(),P();return}},document.addEventListener("keydown",w,!0)),p.copy=v,p.paste=P,{copy:v,paste:P,destroy(){w&&document.removeEventListener("keydown",w,!0)}}},destroy(m){m&&typeof m.destroy=="function"&&m.destroy()}};export{S as ClipboardPlugin,S as default};
