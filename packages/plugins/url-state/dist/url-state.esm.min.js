var U={prefix:"",pushState:!0,syncSort:!0,syncFilter:!0,syncSearch:!0},S={name:"url-state",init(m){let{eventBus:r,table:s,options:h}=m;if(!s){console.error("UrlStatePlugin: table is undefined");return}if(!r){console.error("UrlStatePlugin: eventBus is undefined");return}let o={...U,...h},d=!1,c=null;function l(t){return new URLSearchParams(window.location.search).get(o.prefix+t)}function g(t){let e=new URLSearchParams(window.location.search);for(let[w,f]of Object.entries(t)){let p=o.prefix+w;f==null||f===""?e.delete(p):e.set(p,String(f))}let n=e.toString(),i=n?`${window.location.pathname}?${n}`:window.location.pathname;o.pushState?window.history.pushState({},"",i):window.history.replaceState({},"",i)}function a(){if(d)return;let t=s.getState(),e={};o.syncSort&&(t.sort&&t.sort.column&&t.sort.direction?e.sort=`${t.sort.column}:${t.sort.direction}`:e.sort=null),(o.syncSearch||o.syncFilter)&&(t.globalFilter?e.search=t.globalFilter:e.search=null),g(e),r&&r.emit&&r.emit("urlstate:update",{updates:e})}function u(){d=!0;let t=!1;try{if(o.syncSort){let e=l("sort");if(e&&e.includes(":")){let[n,i]=e.split(":");n&&(i==="asc"||i==="desc")&&(s.sort(n,i),t=!0)}}if(o.syncSearch||o.syncFilter){let e=l("search");if(e){s.filter(e);let n=document.querySelector(".bw-datatable__search");n&&(n.value=e),t=!0}}t&&r&&r.emit&&r.emit("urlstate:restore",{sort:l("sort"),search:l("search")})}catch(e){console.error("UrlStatePlugin: Error restoring state",e)}d=!1}return r.on("sort",a),r.on("sort:after",a),r.on("filter",a),r.on("filter:after",a),r.on("filter:clear",a),c=()=>{u()},window.addEventListener("popstate",c),setTimeout(()=>{u()},0),s.getUrlState=()=>({sort:l("sort"),search:l("search")}),s.updateUrl=a,s.restoreFromUrl=u,{name:"url-state",updateUrl:a,restoreFromUrl:u,getUrlState:s.getUrlState,destroy(){c&&window.removeEventListener("popstate",c),delete s.getUrlState,delete s.updateUrl,delete s.restoreFromUrl}}}};export{S as UrlStatePlugin,S as default};
