var k={prefix:"",pushState:!0,watchPopState:!0,syncPage:!0,syncSort:!0,syncFilter:!0,syncSearch:!0},j={name:"url-state",init(f){let{eventBus:l,table:n,getState:h,options:T}=f,s={...k,...T},u=!1;function a(t){return s.prefix+t}function S(){return new URLSearchParams(window.location.search)}function P(t){let e=new URL(window.location.href);e.search=t.toString(),s.pushState?window.history.pushState({},"",e):window.history.replaceState({},"",e)}function g(){if(u)return;let t=h(),e=S();for(let r of[...e.keys()])r.startsWith(s.prefix)&&e.delete(r);if(s.syncPage&&t.page>0&&e.set(a("page"),t.page+1),s.syncSort&&t.sort.length>0){let r=t.sort.map(o=>`${o.column}:${o.dir}`).join(",");e.set(a("sort"),r)}if(s.syncSearch&&t.globalFilter&&e.set(a("search"),t.globalFilter),s.syncFilter&&Object.keys(t.filters).length>0)for(let[r,o]of Object.entries(t.filters))e.set(a(`filter_${r}`),o);P(e),l.emit("urlstate:change",{params:Object.fromEntries(e)})}function p(){u=!0;let t=S(),e=h(),r=!1;if(s.syncPage){let o=t.get(a("page"));if(o){let i=parseInt(o,10)-1;i>=0&&i!==e.page&&(n.goToPage(i),r=!0)}}if(s.syncSort){let o=t.get(a("sort"));if(o){let[i,c]=o.split(":");i&&(c==="asc"||c==="desc")&&(n.sort(i,c),r=!0)}}if(s.syncSearch){let o=t.get(a("search"));o&&o!==e.globalFilter&&(n.filter("global",o),r=!0)}if(s.syncFilter)for(let[o,i]of t.entries()){let c=a("filter_");if(o.startsWith(c)){let F=o.slice(c.length);e.filters[F]!==i&&(n.filter(F,i),r=!0)}}u=!1,r&&l.emit("urlstate:restore",{params:Object.fromEntries(t)})}function U(){let t=h(),e={};if(s.syncPage&&t.page>0&&(e.page=t.page+1),s.syncSort&&t.sort.length>0&&(e.sort=t.sort.map(r=>`${r.column}:${r.dir}`).join(",")),s.syncSearch&&t.globalFilter&&(e.search=t.globalFilter),s.syncFilter&&Object.keys(t.filters).length>0)for(let[r,o]of Object.entries(t.filters))e[`filter_${r}`]=o;return e}function b(t){if(u=!0,t.page&&n.goToPage(parseInt(t.page,10)-1),t.sort){let[e,r]=t.sort.split(":");e&&r&&n.sort(e,r)}t.search&&n.filter("global",t.search);for(let[e,r]of Object.entries(t))if(e.startsWith("filter_")){let o=e.slice(7);n.filter(o,r)}u=!1,g()}function w(){let t=S();for(let e of[...t.keys()])e.startsWith(s.prefix)&&t.delete(e);P(t),l.emit("urlstate:change",{params:{}})}let d=null;function m(){d&&clearTimeout(d),d=setTimeout(()=>{g()},50)}l.on("sort:after",()=>{s.syncSort&&m()}),l.on("filter:after",()=>{(s.syncFilter||s.syncSearch)&&m()}),l.on("render:after",()=>{s.syncPage&&m()});let y=null;return s.watchPopState&&(y=()=>{p()},window.addEventListener("popstate",y)),p(),n.getUrlState=U,n.setUrlState=b,n.clearUrlState=w,n.syncUrlToState=p,n.syncStateToUrl=g,{getUrlState:U,setUrlState:b,clearUrlState:w,syncFromUrl:p,syncToUrl:g,destroy(){y&&window.removeEventListener("popstate",y)}}},destroy(f){f&&typeof f.destroy=="function"&&f.destroy()}};export{j as UrlStatePlugin,j as default};
