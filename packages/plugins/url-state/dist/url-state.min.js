var BWUrlState=(()=>{var U=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var $=(a,i)=>{for(var n in i)U(a,n,{get:i[n],enumerable:!0})},E=(a,i,n,u)=>{if(i&&typeof i=="object"||typeof i=="function")for(let f of x(i))!O.call(a,f)&&f!==n&&U(a,f,{get:()=>i[f],enumerable:!(u=v(i,f))||u.enumerable});return a};var L=a=>E(U({},"__esModule",{value:!0}),a);var _={};$(_,{UrlStatePlugin:()=>b,default:()=>b});var W={prefix:"",pushState:!0,watchPopState:!0,syncPage:!0,syncSort:!0,syncFilter:!0,syncSearch:!0},b={name:"url-state",init(a){let{eventBus:i,table:n,getState:u,options:f}=a,s={...W,...f},p=!1;function c(t){return s.prefix+t}function d(){return new URLSearchParams(window.location.search)}function w(t){let e=new URL(window.location.href);e.search=t.toString(),s.pushState?window.history.pushState({},"",e):window.history.replaceState({},"",e)}function y(){if(p)return;let t=u(),e=d();for(let r of[...e.keys()])r.startsWith(s.prefix)&&e.delete(r);if(s.syncPage&&t.page>0&&e.set(c("page"),t.page+1),s.syncSort&&t.sort.length>0){let r=t.sort.map(o=>`${o.column}:${o.dir}`).join(",");e.set(c("sort"),r)}if(s.syncSearch&&t.globalFilter&&e.set(c("search"),t.globalFilter),s.syncFilter&&Object.keys(t.filters).length>0)for(let[r,o]of Object.entries(t.filters))e.set(c(`filter_${r}`),o);w(e),i.emit("urlstate:change",{params:Object.fromEntries(e)})}function h(){p=!0;let t=d(),e=u(),r=!1;if(s.syncPage){let o=t.get(c("page"));if(o){let l=parseInt(o,10)-1;l>=0&&l!==e.page&&(n.goToPage(l),r=!0)}}if(s.syncSort){let o=t.get(c("sort"));if(o){let[l,g]=o.split(":");l&&(g==="asc"||g==="desc")&&(n.sort(l,g),r=!0)}}if(s.syncSearch){let o=t.get(c("search"));o&&o!==e.globalFilter&&(n.filter("global",o),r=!0)}if(s.syncFilter)for(let[o,l]of t.entries()){let g=c("filter_");if(o.startsWith(g)){let k=o.slice(g.length);e.filters[k]!==l&&(n.filter(k,l),r=!0)}}p=!1,r&&i.emit("urlstate:restore",{params:Object.fromEntries(t)})}function F(){let t=u(),e={};if(s.syncPage&&t.page>0&&(e.page=t.page+1),s.syncSort&&t.sort.length>0&&(e.sort=t.sort.map(r=>`${r.column}:${r.dir}`).join(",")),s.syncSearch&&t.globalFilter&&(e.search=t.globalFilter),s.syncFilter&&Object.keys(t.filters).length>0)for(let[r,o]of Object.entries(t.filters))e[`filter_${r}`]=o;return e}function j(t){if(p=!0,t.page&&n.goToPage(parseInt(t.page,10)-1),t.sort){let[e,r]=t.sort.split(":");e&&r&&n.sort(e,r)}t.search&&n.filter("global",t.search);for(let[e,r]of Object.entries(t))if(e.startsWith("filter_")){let o=e.slice(7);n.filter(o,r)}p=!1,y()}function T(){let t=d();for(let e of[...t.keys()])e.startsWith(s.prefix)&&t.delete(e);w(t),i.emit("urlstate:change",{params:{}})}let m=null;function P(){m&&clearTimeout(m),m=setTimeout(()=>{y()},50)}i.on("sort:after",()=>{s.syncSort&&P()}),i.on("filter:after",()=>{(s.syncFilter||s.syncSearch)&&P()}),i.on("render:after",()=>{s.syncPage&&P()});let S=null;return s.watchPopState&&(S=()=>{h()},window.addEventListener("popstate",S)),h(),n.getUrlState=F,n.setUrlState=j,n.clearUrlState=T,n.syncUrlToState=h,n.syncStateToUrl=y,{getUrlState:F,setUrlState:j,clearUrlState:T,syncFromUrl:h,syncToUrl:y,destroy(){S&&window.removeEventListener("popstate",S)}}},destroy(a){a&&typeof a.destroy=="function"&&a.destroy()}};return L(_);})();
BWUrlState=BWUrlState.UrlStatePlugin;
